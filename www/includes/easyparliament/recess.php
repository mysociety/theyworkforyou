<?php

/*
recess.php 2004-06-05
francis@flourish.org
*/

/* UK Parliament */
$GLOBALS['recessdates'][1] = [
    2000 => [
        12 => ['more' => 21],
    ],
    2001 => [
        1 => ['less' => 8],
        2 => ['between' => [15,26]],
        4 => ['between' => [10,23]],
        5 => ['more' => 13],
        6 => ['less' => 13],
        7 => ['more' => 20],
        8 => ['all' => 1],
        9 => ['less' => 14, 'more' => 14],
        10 => ['less' => 4, 'between' => [4,8, 8,15]],
        12 => ['more' => 19] ],
    2002 => [
        1 => ['less' => 8],
        2 => ['between' => [14,25]],
        3 => ['more' => 26],
        4 => ['less' => 3, 'between' => [3,10]],
        5 => ['more' => 24],
        6 => ['less' => 10],
        7 => ['more' => 24],
        8 => ['all' => 1],
        9 => ['less' => 19, 'more' => 24],
        10 => ['less' => 14],
        12 => ['more' => 19] ],
    2003 => [
        1 => ['less' => 7],
        2 => ['between' => [13,24]],
        4 => ['between' => [14,28]],
        5 => ['more' => 22],
        6 => ['less' => 3],
        7 => ['more' => 17],
        8 => ['all' => 1],
        9 => ['less' => 8, 'more' => 18],
        10 => ['less' => 14],
        12 => ['more' => 18]],
    2004 => [
        1 => ['less' => 5],
        2 => ['between' => [12,23]],
        4 => ['between' => [1,19]],
        5 => ['more' => 27],
        6 => ['less' => 7],
        7 => ['more' => 22],
        8 => ['all' => 1],
        9 => ['less' => 7, 'more' => 16],
        10 => ['less' => 11],
        12 => ['more' => 21] ],
    2005 => [
        1 => ['less' => 10],
        2 => ['between' => [10,21]],
        3 => ['more' => 24],
        4 => ['less' => 4, 'more' => 10],
        5 => ['less' => 11, 'more' => 26],
        6 => ['less' => 6],
        7 => ['more' => 21],
        8 => ['all' => 1],
        9 => ['all' => 1],
        10 => ['less' => 10],
        12 => ['more' => 20] ],
    2006 => [
        1 => ['less' => 9],
        2 => ['between' => [16,27]],
        3 => ['more' => 30],
        4 => ['less' => 18],
        5 => ['more' => 25],
        6 => ['less' => 5],
        7 => ['more' => 25],
        8 => ['all' => 1],
        9 => ['all' => 1],
        10 => ['less' => 9],
        12 => ['more' => 19],
    ],
    2007 => [
        1 => ['less' => 8],
        2 => ['between' => [8,19]],
        3 => ['more' => 29],
        4 => ['less' => 16],
        5 => ['more' => 24],
        6 => ['less' => 4],
        7 => ['more' => 26],
        8 => ['all' => 1],
        9 => ['all' => 1],
        10 => ['less' => 8],
        12 => ['more' => 18],
    ],
    2008 => [
        1 => ['less' => 7],
        2 => ['between' => [7,18]],
        4 => ['between' => [3,21]],
        5 => ['more' => 22],
        6 => ['less' => 2],
        7 => ['more' => 22],
        8 => ['all' => 1],
        9 => ['all' => 1],
        10 => ['less' => 6],
        12 => ['more' => 18],
    ],
    2009 => [
        1 => ['less' => 12],
        2 => ['between' => [12,23]],
        4 => ['between' => [2,20]],
        5 => ['more' => 21],
        6 => ['less' => 1],
        7 => ['more' => 21],
        8 => ['all' => 1],
        9 => ['all' => 1],
        10 => ['less' => 12],
        12 => ['more' => 16],
    ],
    2010 => [
        1 => ['less' => 5],
        2 => ['between' => [10,22]],
        3 => ['more' => 30],
        4 => ['less' => 6, 'more' => 8],
        5 => ['less' => 18, 'more' => 27],
        6 => ['less' => 2],
        7 => ['more' => 27],
        8 => ['all' => 1],
        9 => ['less' => 6, 'more' => 16],
        10 => ['less' => 11],
        12 => ['more' => 21],
    ],
    2011 => [
        1 => ['less' => 10],
        2 => ['between' => [17,28]],
        4 => ['between' => [5,26]],
        5 => ['more' => 24],
        6 => ['less' => 7],
        7 => ['more' => 19],
        8 => ['all' => 1],
        9 => ['less' => 5, 'more' => 15],
        10 => ['less' => 10],
        11 => ['between' => [15,21]],
        12 => ['more' => 20],
    ],
    2012 => [
        1 => ['less' => 10],
        2 => ['between' => [9,20]],
        3 => ['more' => 27],
        4 => ['less' => 16],
        5 => ['more' => 24],
        6 => ['less' => 11],
        7 => ['more' => 17],
        8 => ['all' => 1],
        9 => ['less' => 3,'more' => 18],
        10 => ['less' => 15],
        11 => ['between' => [13,19]],
        12 => ['more' => 20],
    ],
    2013 => [
        1 => ['less' => 7],
        2 => ['between' => [14,25]],
        3 => ['more' => 26],
        4 => ['less' => 15],
        5 => ['more' => 21],
        6 => ['less' => 3],
        7 => ['more' => 18],
        8 => ['all' => 1],
        9 => ['less' => 2,'more' => 13],
        10 => ['less' => 8],
        11 => ['between' => [12,18]],
        12 => ['more' => 19],
    ],
    2014 => [
        1 => ['less' => 6],
        2 => ['between' => [13,24]],
        4 => ['between' => [10,28]],
        5 => ['between' => [1,6]],
    ],
    2015 => [
        7 => ['more' => 21],
        8 => ['all' => 1],
        9 => ['less' => 7, 'more' => 17],
        10 => ['less' => 12],
        11 => ['between' => [10,16]],
        12 => ['more' => 17],
    ],
    2016 => [
        1 => ['less' => 5],
        2 => ['between' => [11,22]],
    ],
];
# Lords differences
$GLOBALS['recessdates'][101] = $GLOBALS['recessdates'][1];
$GLOBALS['recessdates'][101][2010][5]['more'] = 26;
$GLOBALS['recessdates'][101][2010][7]['more'] = 28;
$GLOBALS['recessdates'][101][2010][9] = ['all' => 1];
$GLOBALS['recessdates'][101][2010][10]['less'] = 5;
$GLOBALS['recessdates'][101][2010][12]['more'] = 22;
$GLOBALS['recessdates'][101][2011] = [
    1 => ['less' => 10],
    2 => ['between' => [16,28]],
    4 => ['between' => [6,26]],
    5 => ['more' => 25],
    6 => ['less' => 6],
    7 => ['more' => 20],
    8 => ['all' => 1],
    9 => ['less' => 5, 'more' => 15],
    10 => ['less' => 3],
    11 => ['between' => [16,21]],
    12 => ['more' => 21],
];

/* Scottish Parliament */
$GLOBALS['recessdates'][4] = [
    1999 => [
        7 => ['more' => 2],
        8 => ['less' => 31],
        10 => ['between' => [8,25]],
        12 => ['more' => 17],
    ],
    2000 => [
        1 => ['less' => 10],
        4 => ['between' => [7,25]],
        7 => ['more' => 7],
        8 => ['all' => 1],
        9 => ['less' => 4],
        10 => ['between' => [6,23]],
        12 => ['more' => 20],
    ],
    2001 => [
        1 => ['less' => 8],
        2 => ['between' => [16,26]],
        4 => ['between' => [6,23]],
        6 => ['more' => 29],
        7 => ['all' => 1],
        8 => ['all' => 1],
        9 => ['less' => 3],
        10 => ['between' => [5,22]],
        12 => ['more' => 21] ],
    2002 => [
        1 => ['less' => 7],
        2 => ['between' => [15,25]],
        3 => ['more' => 28],
        4 => ['less' => 15],
        7 => ['more' => 10],
        8 => ['all' => 1],
        9 => ['less' => 2],
        10 => ['between' => [11,28]],
        12 => ['more' => 20] ],
    2003 => [
        1 => ['less' => 6],
        4 => ['between' => [0,31]],
        5 => ['less' => 2],
        6 => ['more' => 27],
        7 => ['all' => 1],
        8 => ['all' => 1],
        10 => ['between' => [10,27]],
        12 => ['more' => 19]],
    2004 => [
        1 => ['less' => 5],
        2 => ['between' => [13,23]],
        4 => ['between' => [2,19]],
        6 => ['more' => 25],
        7 => ['all' => 1],
        8 => ['less' => 30],
        10 => ['between' => [10,23]],
        12 => ['more' => 26] ],
    2005 => [
        1 => ['less' => 8],
        2 => ['between' => [11,21]],
        3 => ['more' => 24],
        4 => ['less' => 11],
        7 => ['more' => 1],
        8 => ['all' => 1],
        9 => ['less' => 5],
        10 => ['between' => [7,24]],
        12 => ['more' => 23] ],
    2006 => [
        1 => ['less' => 9],
        2 => ['between' => [10,20]],
        4 => ['less' => 18],
        7 => ['more' => 0],
        8 => ['all' => 1],
        9 => ['less' => 4],
        10 => ['between' => [6,23]],
        12 => ['more' => 22],
    ],
    2007 => [
        1 => ['less' => 8],
        4 => ['more' => 2],
        6 => ['more' => 29],
        7 => ['all' => 1],
        8 => ['all' => 1],
        9 => ['less' => 3],
        10 => ['between' => [5,22]],
        12 => ['more' => 21],
    ],
    2008 => [
        1 => ['less' => 5],
        2 => ['between' => [8,18]],
        3 => ['more' => 28],
        4 => ['less' => 14],
        6 => ['more' => 27],
        7 => ['all' => 1],
        8 => ['all' => 1],
        10 => ['between' => [10,27]],
    ],
];

/* NI Assembly */
$GLOBALS['recessdates'][5] = [
    2010 => [
        3 => ['more' => 26],
        4 => ['less' => 12],
        7 => ['more' => 2],
        8 => ['all' => 1],
        9 => ['less' => 6],
        10 => ['more' => 22],
        12 => ['more' => 17],
    ],
    2011 => [
        1 => ['less' => 10],
        4 => ['more' => 15],
        5 => ['less' => 2],
        7 => ['more' => 1],
    ],
];

/*
function currently_in_recess() {
    // Main file which recesswatcher.py overwrites each day
    $h = fopen(RECESSFILE, "r");
    $today = date("Y-m-d");
    while ($line = fgets($h)) {
        list($name, $from, $to) = explode(",", $line);
        if ($from <= $today and $today <= $to) {
            return array($name, trim($from), trim($to));
        }
    }
    // Second manual override file
    $h = fopen(RECESSFILE.".extra", "r");
    while ($line = fgets($h)) {
        list($name, $from, $to) = explode(",", $line);
        if ($from <= $today and $today <= $to) {
            return array($name, trim($from), trim($to));
        }
    }

    return false;
}
*/

function recess_prettify($day, $month, $year, $body) {
    global $recessdates;
    $dates = $recessdates[$body];
    $recess = 0;
    $from = '';
    $to = '';
    if (isset($dates[$year][$month]['all'])) {
        $recess = 'Summer Recess';
        if (isset($dates[$year][7]['all'])) {
            $from = "$year-6-" . $dates[$year][6]['more'];
        } else {
            $from = "$year-7-" . $dates[$year][7]['more'];
        }
        if (!isset($dates[$year][9])) {
            $to = "$year-08-31";
        } elseif (isset($dates[$year][9]['all'])) {
            $to = "$year-10-" . $dates[$year][10]['less'];
        } else {
            $to = "$year-9-" . $dates[$year][9]['less'];
        }
    }
    if ((isset($dates[$year][$month]['less']) && $day < $dates[$year][$month]['less'])
    || (isset($dates[$year][$month]['more']) && $day > $dates[$year][$month]['more'])
    || (isset($dates[$year][$month]['between']) && $day > $dates[$year][$month]['between'][0] && $day < $dates[$year][$month]['between'][1])
    || (isset($dates[$year][$month]['between'][2]) && $day > $dates[$year][$month]['between'][2] && $day < $dates[$year][$month]['between'][3])) {
        switch ($month) {
            case 1: case 12: $recess = 'Christmas Recess';
                break;
            case 2: if ($body == 1 || $body == 101) {
                $recess = 'Half Term Week';
            } elseif ($body == 4) {
                $recess = 'February Recess';
            }
                break;
            case 3: if ($body == 1 || $body == 101) {
                $recess = 'Easter Recess';
            } elseif ($body == 4) {
                $recess = 'Spring Recess';
            }
                break;
            case 4: if (isset($dates[$year][$month]['more']) && $day > $dates[$year][$month]['more']) {
                $recess = 'Election Recess';
            } elseif ($body == 4 && $year == 2003) {
                $recess = 'Election Recess';
            } elseif ($body == 1 || $body == 101) {
                $recess = 'Easter Recess';
            } elseif ($body == 4) {
                $recess = 'Spring Recess';
            }
                break;
            case 5: if ($year == 2001 || (isset($dates[$year][$month]['less']) && $day < $dates[$year][$month]['less'])) {
                $recess = 'Election Recess';
            } else {
                $recess = 'Whit Recess';
            }
                break;
            case 6: if ($year == 2001) {
                $recess = 'Election Recess';
            } elseif ($body == 1 || $body == 101) {
                $recess = 'Whit Recess';
            } elseif ($body == 4) {
                $recess = 'Summer Recess';
            } else {
                trigger_error("Argh6");
            }
                break;
            case 7: case 8: $recess = 'Summer Recess';
                break;
            case 9: if (isset($dates[$year][$month]['less']) && $day < $dates[$year][$month]['less']) {
                $recess = 'Summer Recess';
            } elseif ($body == 1 || $body == 101) {
                $recess = 'Conference Recess';
            } else {
                trigger_error("Argh9");
            }
                break;
            case 10: if ($body == 1 || $body == 101) {
                $recess = 'Conference Recess';
            } elseif ($body == 4) {
                $recess = 'Autumn Recess';
            } elseif ($body == 5) {
                $recess = 'Halloween Recess';
            }
                break;
            case 11: $recess = 'Autumn Recess';
                break;
            default: $recess = 1;
        }
        if (isset($dates[$year][$month]['less']) && $day < $dates[$year][$month]['less']) {
            $to = "$year-$month-" . $dates[$year][$month]['less'];
            if ($month == 1) {
                $from = ($year - 1) . "-12-" . $dates[$year - 1][12]['more'];
            } else {
                for ($newmonth = $month - 1; $newmonth >= 1; $newmonth--) {
                    if (isset($dates[$year][$newmonth]['more'])) {
                        $from = "$year-" . ($newmonth) . "-" . $dates[$year][$newmonth]['more'];
                        break;
                    }
                }
            }
        }
        if (isset($dates[$year][$month]['more']) && $day > $dates[$year][$month]['more']) {
            $from = "$year-$month-" . $dates[$year][$month]['more'];
            if ($month == 12) {
                $to = ($year + 1) . "-01-" . $dates[$year + 1][1]['less'];
            } else {
                for ($newmonth = $month + 1; $newmonth <= 12; $newmonth++) {
                    if (isset($dates[$year][$newmonth]['less'])) {
                        $to = "$year-" . ($newmonth) . "-" . $dates[$year][$newmonth]['less'];
                        break;
                    }
                }
            }
        }
        if (isset($dates[$year][$month]['between']) && $day > $dates[$year][$month]['between'][0] && $day < $dates[$year][$month]['between'][1]) {
            $from = "$year-$month-" . $dates[$year][$month]['between'][0];
            $to = "$year-$month-" . $dates[$year][$month]['between'][1];
        }
        if (isset($dates[$year][$month]['between'][2]) && $day > $dates[$year][$month]['between'][2] && $day < $dates[$year][$month]['between'][3]) {
            $from = "$year-$month-" . $dates[$year][$month]['between'][2];
            $to = "$year-$month-" . $dates[$year][$month]['between'][3];
        }
    }
    return [$recess, $from, $to];
}
